<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trouver un Espace TT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #74ebd5, #ACB6E5);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    width: 95%;
    max-width: 1100px;
    background: white;
    border-radius: 25px;
    padding: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.25);
    text-align: center;
}

h2 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.back-btn {
    display: inline-block;
    margin-bottom: 10px;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    background: #3498db;
    color: white;
    font-size: 15px;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: 0.3s;
}

.back-btn:hover {
    background: #2a7bbd;
}

/* LANGUAGE SWITCH */
.lang-switch {
    text-align: center;
    margin-bottom: 10px;
}

.lang-switch button {
    padding: 6px 14px;
    margin: 0 5px;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    background: #3498db;
    color: white;
}

/* MAP */
#map {
    width: 100%;
    height: 500px;
    border-radius: 15px;
    margin-top: 10px;
}

#findTTBtn {
    margin-top: 10px;
    padding: 10px 25px;
    border-radius: 25px;
    border: none;
    background: #e74c3c;
    color: white;
    cursor: pointer;
    font-size: 16px;
    transition: 0.3s;
}
#findTTBtn:hover {
    background: #c0392b;
}
</style>
</head>
<body>

<div class="container">

    <!-- LANGUAGE SWITCH -->
    <div class="lang-switch">
        <button onclick="setLang('fr')">FR</button>
        <button onclick="setLang('ar')">AR</button>
        <button onclick="setLang('en')">EN</button>
    </div>

    <!-- BACK BUTTON -->
    <a href="index.html" class="back-btn" id="backBtn">â¬…ï¸ Retour Ã  l'accueil</a>

    <!-- PAGE TITLE -->
    <h2 id="pageTitle">ğŸ“ Trouver un espace Tunisieâ€¯Telecom</h2>

    <!-- MAP -->
    <div id="map"></div>

    <!-- BUTTON TO FIND NEAREST Espace TT -->
    <button id="findTTBtn">ğŸ“Œ Trouver un Espace TT proche</button>

    <!-- INFO TEXT -->
    <p id="infoText" style="margin-top:10px; color:#555; font-size:14px;">
        Vous pouvez cliquer sur chaque point pour voir le nom et l'adresse de l'Espace TT.
    </p>

</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ===== TRANSLATION =====
const texts = {
    fr: {
        backBtn: "â¬…ï¸ Retour Ã  l'accueil",
        pageTitle: "ğŸ“ Trouver un espace Tunisieâ€¯Telecom",
        infoText: "Vous pouvez cliquer sur chaque point pour voir le nom et l'adresse de l'Espace TT.",
        findBtn: "ğŸ“Œ Trouver un Espace TT proche"
    },
    ar: {
        backBtn: "â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        pageTitle: "ğŸ“ Ø¥ÙŠØ¬Ø§Ø¯ ÙØ¶Ø§Ø¡ Ø§ØªØµØ§Ù„Ø§Øª ØªÙˆÙ†Ø³",
        infoText: "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙƒÙ„ Ù†Ù‚Ø·Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ø³Ù… ÙˆØ¹Ù†ÙˆØ§Ù† ÙØ¶Ø§Ø¡ Ø§ØªØµØ§Ù„Ø§Øª ØªÙˆÙ†Ø³.",
        findBtn: "ğŸ“Œ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù‚Ø±Ø¨ ÙØ¶Ø§Ø¡ TT"
    },
    en: {
        backBtn: "â¬…ï¸ Back to Home",
        pageTitle: "ğŸ“ Find a Tunisie Telecom space",
        infoText: "You can click on each point to see the name and address of the TT Space.",
        findBtn: "ğŸ“Œ Find nearest TT Space"
    }
};

function setLang(lang) {
    document.getElementById("backBtn").innerHTML = texts[lang].backBtn;
    document.getElementById("pageTitle").innerHTML = texts[lang].pageTitle;
    document.getElementById("infoText").innerHTML = texts[lang].infoText;
    document.getElementById("findTTBtn").innerHTML = texts[lang].findBtn;

    if(lang === 'ar'){
        document.body.dir = "rtl";
    } else {
        document.body.dir = "ltr";
    }
}

// default language
setLang('fr');

// ===== LEAFLET MAP =====
const map = L.map('map').setView([36.8, 10.2], 7);

// tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// ===== TT SPACES =====
const espacesTT = [
    {name: "Espace TT Tunis Centre", address:"Avenue Habib Bourguiba, Tunis", coords:[36.8008, 10.1825]},
    {name: "Espace TT La Marsa", address:"Route de La Marsa, La Marsa", coords:[36.875, 10.330]},
    {name: "Espace TT Sousse", address:"Avenue Hedi Chaker, Sousse", coords:[35.8256, 10.636]},
    {name: "Espace TT Sfax", address:"Rue Habib Bourguiba, Sfax", coords:[34.7406, 10.760]},
    {name: "Espace TT Bizerte", address:"Rue de la LibertÃ©, Bizerte", coords:[37.2742, 9.873]},
    {name: "Espace TT Kairouan", address:"Avenue Habib Bourguiba, Kairouan", coords:[35.6789, 10.101]},
];

// Ø¥Ø¶Ø§ÙØ© markers
espacesTT.forEach(function(e){
    L.marker(e.coords).addTo(map)
        .bindPopup("<b>"+e.name+"</b><br>"+e.address);
});

// ===== FIND NEAREST TT SPACE =====
function distance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2-lat1)*Math.PI/180;
    const dLon = (lon2-lon1)*Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function findNearest(userCoords, espaces) {
    let minDist = Infinity;
    let nearest = null;
    espaces.forEach(e => {
        const d = distance(userCoords[0], userCoords[1], e.coords[0], e.coords[1]);
        if(d < minDist){
            minDist = d;
            nearest = e;
        }
    });
    return nearest;
}

document.getElementById("findTTBtn").addEventListener("click", () => {
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos => {
            const userCoords = [pos.coords.latitude, pos.coords.longitude];
            const nearest = findNearest(userCoords, espacesTT);

            L.marker(userCoords, {icon: L.icon({iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png', iconSize:[30,30]})})
                .addTo(map).bindPopup("ğŸ“ Votre position").openPopup();

            L.popup()
              .setLatLng(nearest.coords)
              .setContent("<b>"+nearest.name+"</b><br>"+nearest.address)
              .openOn(map);

            map.setView(nearest.coords, 14);
        }, err => { alert("Impossible de rÃ©cupÃ©rer votre position."); });
    } else {
        alert("GÃ©olocalisation non supportÃ©e par votre navigateur.");
    }
});
</script>

</body>
</html>
